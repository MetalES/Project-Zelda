chest appear process


if not entity:get_value("chest_appeared") then chest:get_sprite():fade_out(1) end

function entity:on_activated()
sol.audio.play_sound("/common/secret_discover_minor")

sol.timer.start(100, function()
local x, y, layer = chest:get_position()
--chest:set_position(x, y, layer + 1)
local chest_effect = map:create_custom_entity({
      x = x,
      y = y - 5,
      layer = layer,
      direction = 0,
      sprite = "entities/dungeon/gameplay_sequence_chest_appearing",
    })

  local m = sol.movement.create("straight")
  m:set_ignore_obstacles(true)
  m:set_speed(1)
  m:set_angle(math.pi / 2)
  m:set_max_distance(32)
  m:start(chest_effect)

chest_effect:get_sprite():fade_out(1)
chest_effect:get_sprite():fade_in(30)

sol.audio.play_sound("/common/chest_appear")

sol.timer.start(2900, function()
chest:get_sprite():fade_in(40) 
end)

sol.timer.start(5000, function()
chest_effect:get_sprite():fade_out(10) 
end)

sol.timer.start(6000, function()
chest_effect:remove()
chest:set_enabled(true)
end)

end)


end